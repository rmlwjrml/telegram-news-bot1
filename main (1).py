
import requests
from bs4 import BeautifulSoup
import telegram
import time
from threading import Thread

keywords = ['키워드1', '키워드2', '키워드3', '키워드4', '키워드5', '키워드6', '키워드7', '키워드8', '키워드9', '키워드10', '키워드11', '키워드12', '키워드13', '키워드14', '키워드15', '키워드16', '키워드17', '키워드18', '키워드19', '키워드20', '키워드21', '키워드22', '키워드23', '키워드24', '키워드25', '키워드26', '키워드27', '키워드28', '키워드29', '키워드30', '키워드31', '키워드32', '키워드33', '키워드34', '키워드35', '키워드36', '키워드37', '키워드38', '키워드39', '키워드40', '키워드41', '키워드42', '키워드43', '키워드44', '키워드45', '키워드46', '키워드47', '키워드48', '키워드49', '키워드50', '키워드51', '키워드52', '키워드53', '키워드54', '키워드55', '키워드56', '키워드57', '키워드58', '키워드59', '키워드60', '키워드61', '키워드62', '키워드63', '키워드64', '키워드65', '키워드66', '키워드67', '키워드68', '키워드69', '키워드70', '키워드71', '키워드72', '키워드73', '키워드74', '키워드75', '키워드76', '키워드77', '키워드78', '키워드79', '키워드80', '키워드81', '키워드82', '키워드83', '키워드84', '키워드85', '키워드86', '키워드87', '키워드88', '키워드89', '키워드90', '키워드91', '키워드92', '키워드93', '키워드94', '키워드95', '키워드96', '키워드97', '키워드98', '키워드99', '키워드100', '키워드101', '키워드102', '키워드103', '키워드104', '키워드105', '키워드106', '키워드107', '키워드108', '키워드109', '키워드110', '키워드111', '키워드112', '키워드113', '키워드114', '키워드115', '키워드116', '키워드117', '키워드118', '키워드119', '키워드120', '키워드121', '키워드122', '키워드123', '키워드124', '키워드125', '키워드126', '키워드127', '키워드128', '키워드129', '키워드130', '키워드131', '키워드132', '키워드133', '키워드134', '키워드135', '키워드136', '키워드137', '키워드138', '키워드139', '키워드140', '키워드141', '키워드142', '키워드143', '키워드144', '키워드145', '키워드146', '키워드147', '키워드148', '키워드149', '키워드150', '키워드151', '키워드152', '키워드153', '키워드154', '키워드155', '키워드156', '키워드157', '키워드158', '키워드159', '키워드160', '키워드161', '키워드162', '키워드163', '키워드164', '키워드165', '키워드166', '키워드167', '키워드168', '키워드169', '키워드170', '키워드171', '키워드172', '키워드173', '키워드174', '키워드175', '키워드176', '키워드177', '키워드178', '키워드179', '키워드180', '키워드181', '키워드182', '키워드183', '키워드184', '키워드185', '키워드186', '키워드187', '키워드188', '키워드189', '키워드190', '키워드191', '키워드192', '키워드193', '키워드194', '키워드195', '키워드196', '키워드197', '키워드198', '키워드199', '키워드200']

bots = {
    "A": {"token": "7440645018:AAG_yFBsdyaMmhK_He7lI3EBWggLK9wenXg", "chat_id": "5639589613"},
    "B": {"token": "7440645018:AAG_yFBsdyaMmhK_He7lI3EBWggLK9wenXg", "chat_id": "5639589613"},
    "C": {"token": "7513053048:AAGhoPamVwZhGYqztK0huXWxg0FQ1W204fI", "chat_id": "5639589613"}
}

channels = [{'name': '채널1', 'url': 'https://news.example.com/channel1', 'selector': 'ul.news_list li a'}, {'name': '채널2', 'url': 'https://news.example.com/channel2', 'selector': 'ul.news_list li a'}, {'name': '채널3', 'url': 'https://news.example.com/channel3', 'selector': 'ul.news_list li a'}, {'name': '채널4', 'url': 'https://news.example.com/channel4', 'selector': 'ul.news_list li a'}, {'name': '채널5', 'url': 'https://news.example.com/channel5', 'selector': 'ul.news_list li a'}, {'name': '채널6', 'url': 'https://news.example.com/channel6', 'selector': 'ul.news_list li a'}, {'name': '채널7', 'url': 'https://news.example.com/channel7', 'selector': 'ul.news_list li a'}, {'name': '채널8', 'url': 'https://news.example.com/channel8', 'selector': 'ul.news_list li a'}, {'name': '채널9', 'url': 'https://news.example.com/channel9', 'selector': 'ul.news_list li a'}, {'name': '채널10', 'url': 'https://news.example.com/channel10', 'selector': 'ul.news_list li a'}, {'name': '채널11', 'url': 'https://news.example.com/channel11', 'selector': 'ul.news_list li a'}, {'name': '채널12', 'url': 'https://news.example.com/channel12', 'selector': 'ul.news_list li a'}, {'name': '채널13', 'url': 'https://news.example.com/channel13', 'selector': 'ul.news_list li a'}, {'name': '채널14', 'url': 'https://news.example.com/channel14', 'selector': 'ul.news_list li a'}, {'name': '채널15', 'url': 'https://news.example.com/channel15', 'selector': 'ul.news_list li a'}, {'name': '채널16', 'url': 'https://news.example.com/channel16', 'selector': 'ul.news_list li a'}, {'name': '채널17', 'url': 'https://news.example.com/channel17', 'selector': 'ul.news_list li a'}, {'name': '채널18', 'url': 'https://news.example.com/channel18', 'selector': 'ul.news_list li a'}, {'name': '채널19', 'url': 'https://news.example.com/channel19', 'selector': 'ul.news_list li a'}, {'name': '채널20', 'url': 'https://news.example.com/channel20', 'selector': 'ul.news_list li a'}, {'name': '채널21', 'url': 'https://news.example.com/channel21', 'selector': 'ul.news_list li a'}, {'name': '채널22', 'url': 'https://news.example.com/channel22', 'selector': 'ul.news_list li a'}, {'name': '채널23', 'url': 'https://news.example.com/channel23', 'selector': 'ul.news_list li a'}, {'name': '채널24', 'url': 'https://news.example.com/channel24', 'selector': 'ul.news_list li a'}, {'name': '채널25', 'url': 'https://news.example.com/channel25', 'selector': 'ul.news_list li a'}, {'name': '채널26', 'url': 'https://news.example.com/channel26', 'selector': 'ul.news_list li a'}, {'name': '채널27', 'url': 'https://news.example.com/channel27', 'selector': 'ul.news_list li a'}, {'name': '채널28', 'url': 'https://news.example.com/channel28', 'selector': 'ul.news_list li a'}, {'name': '채널29', 'url': 'https://news.example.com/channel29', 'selector': 'ul.news_list li a'}, {'name': '채널30', 'url': 'https://news.example.com/channel30', 'selector': 'ul.news_list li a'}, {'name': '채널31', 'url': 'https://news.example.com/channel31', 'selector': 'ul.news_list li a'}, {'name': '채널32', 'url': 'https://news.example.com/channel32', 'selector': 'ul.news_list li a'}, {'name': '채널33', 'url': 'https://news.example.com/channel33', 'selector': 'ul.news_list li a'}, {'name': '채널34', 'url': 'https://news.example.com/channel34', 'selector': 'ul.news_list li a'}, {'name': '채널35', 'url': 'https://news.example.com/channel35', 'selector': 'ul.news_list li a'}, {'name': '채널36', 'url': 'https://news.example.com/channel36', 'selector': 'ul.news_list li a'}, {'name': '채널37', 'url': 'https://news.example.com/channel37', 'selector': 'ul.news_list li a'}, {'name': '채널38', 'url': 'https://news.example.com/channel38', 'selector': 'ul.news_list li a'}, {'name': '채널39', 'url': 'https://news.example.com/channel39', 'selector': 'ul.news_list li a'}, {'name': '채널40', 'url': 'https://news.example.com/channel40', 'selector': 'ul.news_list li a'}, {'name': '채널41', 'url': 'https://news.example.com/channel41', 'selector': 'ul.news_list li a'}, {'name': '채널42', 'url': 'https://news.example.com/channel42', 'selector': 'ul.news_list li a'}, {'name': '채널43', 'url': 'https://news.example.com/channel43', 'selector': 'ul.news_list li a'}, {'name': '채널44', 'url': 'https://news.example.com/channel44', 'selector': 'ul.news_list li a'}, {'name': '채널45', 'url': 'https://news.example.com/channel45', 'selector': 'ul.news_list li a'}, {'name': '채널46', 'url': 'https://news.example.com/channel46', 'selector': 'ul.news_list li a'}, {'name': '채널47', 'url': 'https://news.example.com/channel47', 'selector': 'ul.news_list li a'}, {'name': '채널48', 'url': 'https://news.example.com/channel48', 'selector': 'ul.news_list li a'}, {'name': '채널49', 'url': 'https://news.example.com/channel49', 'selector': 'ul.news_list li a'}, {'name': '채널50', 'url': 'https://news.example.com/channel50', 'selector': 'ul.news_list li a'}, {'name': '채널51', 'url': 'https://news.example.com/channel51', 'selector': 'ul.news_list li a'}, {'name': '채널52', 'url': 'https://news.example.com/channel52', 'selector': 'ul.news_list li a'}, {'name': '채널53', 'url': 'https://news.example.com/channel53', 'selector': 'ul.news_list li a'}, {'name': '채널54', 'url': 'https://news.example.com/channel54', 'selector': 'ul.news_list li a'}, {'name': '채널55', 'url': 'https://news.example.com/channel55', 'selector': 'ul.news_list li a'}, {'name': '채널56', 'url': 'https://news.example.com/channel56', 'selector': 'ul.news_list li a'}, {'name': '채널57', 'url': 'https://news.example.com/channel57', 'selector': 'ul.news_list li a'}, {'name': '채널58', 'url': 'https://news.example.com/channel58', 'selector': 'ul.news_list li a'}, {'name': '채널59', 'url': 'https://news.example.com/channel59', 'selector': 'ul.news_list li a'}, {'name': '채널60', 'url': 'https://news.example.com/channel60', 'selector': 'ul.news_list li a'}, {'name': '채널61', 'url': 'https://news.example.com/channel61', 'selector': 'ul.news_list li a'}, {'name': '채널62', 'url': 'https://news.example.com/channel62', 'selector': 'ul.news_list li a'}, {'name': '채널63', 'url': 'https://news.example.com/channel63', 'selector': 'ul.news_list li a'}, {'name': '채널64', 'url': 'https://news.example.com/channel64', 'selector': 'ul.news_list li a'}, {'name': '채널65', 'url': 'https://news.example.com/channel65', 'selector': 'ul.news_list li a'}, {'name': '채널66', 'url': 'https://news.example.com/channel66', 'selector': 'ul.news_list li a'}, {'name': '채널67', 'url': 'https://news.example.com/channel67', 'selector': 'ul.news_list li a'}, {'name': '채널68', 'url': 'https://news.example.com/channel68', 'selector': 'ul.news_list li a'}, {'name': '채널69', 'url': 'https://news.example.com/channel69', 'selector': 'ul.news_list li a'}, {'name': '채널70', 'url': 'https://news.example.com/channel70', 'selector': 'ul.news_list li a'}, {'name': '채널71', 'url': 'https://news.example.com/channel71', 'selector': 'ul.news_list li a'}, {'name': '채널72', 'url': 'https://news.example.com/channel72', 'selector': 'ul.news_list li a'}, {'name': '채널73', 'url': 'https://news.example.com/channel73', 'selector': 'ul.news_list li a'}, {'name': '채널74', 'url': 'https://news.example.com/channel74', 'selector': 'ul.news_list li a'}, {'name': '채널75', 'url': 'https://news.example.com/channel75', 'selector': 'ul.news_list li a'}, {'name': '채널76', 'url': 'https://news.example.com/channel76', 'selector': 'ul.news_list li a'}, {'name': '채널77', 'url': 'https://news.example.com/channel77', 'selector': 'ul.news_list li a'}, {'name': '채널78', 'url': 'https://news.example.com/channel78', 'selector': 'ul.news_list li a'}, {'name': '채널79', 'url': 'https://news.example.com/channel79', 'selector': 'ul.news_list li a'}, {'name': '채널80', 'url': 'https://news.example.com/channel80', 'selector': 'ul.news_list li a'}, {'name': '채널81', 'url': 'https://news.example.com/channel81', 'selector': 'ul.news_list li a'}, {'name': '채널82', 'url': 'https://news.example.com/channel82', 'selector': 'ul.news_list li a'}, {'name': '채널83', 'url': 'https://news.example.com/channel83', 'selector': 'ul.news_list li a'}, {'name': '채널84', 'url': 'https://news.example.com/channel84', 'selector': 'ul.news_list li a'}, {'name': '채널85', 'url': 'https://news.example.com/channel85', 'selector': 'ul.news_list li a'}, {'name': '채널86', 'url': 'https://news.example.com/channel86', 'selector': 'ul.news_list li a'}, {'name': '채널87', 'url': 'https://news.example.com/channel87', 'selector': 'ul.news_list li a'}, {'name': '채널88', 'url': 'https://news.example.com/channel88', 'selector': 'ul.news_list li a'}, {'name': '채널89', 'url': 'https://news.example.com/channel89', 'selector': 'ul.news_list li a'}, {'name': '채널90', 'url': 'https://news.example.com/channel90', 'selector': 'ul.news_list li a'}, {'name': '채널91', 'url': 'https://news.example.com/channel91', 'selector': 'ul.news_list li a'}, {'name': '채널92', 'url': 'https://news.example.com/channel92', 'selector': 'ul.news_list li a'}, {'name': '채널93', 'url': 'https://news.example.com/channel93', 'selector': 'ul.news_list li a'}, {'name': '채널94', 'url': 'https://news.example.com/channel94', 'selector': 'ul.news_list li a'}, {'name': '채널95', 'url': 'https://news.example.com/channel95', 'selector': 'ul.news_list li a'}, {'name': '채널96', 'url': 'https://news.example.com/channel96', 'selector': 'ul.news_list li a'}, {'name': '채널97', 'url': 'https://news.example.com/channel97', 'selector': 'ul.news_list li a'}, {'name': '채널98', 'url': 'https://news.example.com/channel98', 'selector': 'ul.news_list li a'}, {'name': '채널99', 'url': 'https://news.example.com/channel99', 'selector': 'ul.news_list li a'}, {'name': '채널100', 'url': 'https://news.example.com/channel100', 'selector': 'ul.news_list li a'}]

sent_messages = set()

def check_and_send(bot_token, chat_id, news_item):
    text, link = news_item
    if any(k in text for k in keywords) and text not in sent_messages:
        try:
            bot = telegram.Bot(token=bot_token)
            bot.send_message(chat_id=chat_id, text=f"📢 {text}\n{link}")
            sent_messages.add(text)
        except Exception as e:
            print("전송 실패:", e)

def scrape_site(bot_name, urls):
    bot_token = bots[bot_name]['token']
    chat_id = bots[bot_name]['chat_id']
    while True:
        for site in urls:
            try:
                res = requests.get(site['url'], timeout=10)
                soup = BeautifulSoup(res.text, 'html.parser')
                links = soup.select(site['selector'])
                for a in links[:10]:
                    title = a.get_text(strip=True)
                    href = a.get('href')
                    if not href.startswith('http'):
                        href = site['url'].split('/')[0] + '//' + site['url'].split('/')[2] + href
                    check_and_send(bot_token, chat_id, (title, href))
            except Exception as e:
                print(f"[오류] {site['name']}: ", e)
        time.sleep(30)

if __name__ == "__main__":
    chunk = len(channels) // 3
    Thread(target=scrape_site, args=("A", channels[:chunk])).start()
    Thread(target=scrape_site, args=("B", channels[chunk:2*chunk])).start()
    Thread(target=scrape_site, args=("C", channels[2*chunk:])).start()
